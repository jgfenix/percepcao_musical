const SILENCE=0,basicSounds=[`${SILENCE}`,"C4","D4","E4","F4","G4","A4","B4"],synth=(new Tone.Synth).toDestination(),duration=".1n",noiseSynth=(new Tone.NoiseSynth).toDestination(),QUANTIDADE_MINIMA_DE_SONS=5,QUANTIDADE_MAXIMA_DE_SONS=100,BPM_PADRAO=40,QUANTIDADE_MINIMA_BPM=10;var sounds=[],sequenciaResposta=[],qntSons=0,reset=!0;function DBG(...e){}function geraCombinacao(e,n,t,o,a){let s=[];DBG("arr =",e),DBG("qnt =",n),DBG("incluirSilencio =",t),DBG("iniciaEmUm =",o),DBG("incluirSaltos =",a);let i=e[e.length-1];for(;s.length<n;)if(0==s.length)o?s.push(1):s.push(e[rando(e[0],e.length-1)]);else{let e=s[s.length-1];DBG("arr[length-1]=",i);let n=s.includes(i);if(DBG("jaIncluiuValorMaximo=",n),!n){s.push(e+1);continue}if(a){if(1==rando(0,3)){1==e?s.push(i):e==i&&s.push(1);continue}}let t=e+rando(-1,1);DBG("diff = ",t),t>0&&t<=i&&s.push(t)}if(t)for(let e=1;e<s.length;e++){1==rando(0,3)&&(s.splice(e,0,SILENCE),s.pop())}return DBG("combinacao=",s),reset=!1,s}function geraSequencia(e,n,t,o){if(e>=basicSounds.length&&(e=basicSounds.length-1),DBG("qntTons=",e),DBG("incluirSilencio=",n),DBG("incluirSaltos=",o),!sequenciaResposta||0==sequenciaResposta.length){DBG("qntSons=",qntSons);let s=[...Array(e).keys()].map((e=>++e));DBG("seqIndex=",s);let i=geraCombinacao(s,qntSons,n,t,o);DBG("sequenciaAleatoria=",i);for(var a=0;a<i.length;a++)sounds.push(basicSounds[i[a]]);sequenciaResposta=[...i],DBG("sounds=",sounds)}}function cria(){let e=[...sounds];e.push("END"),new Tone.Sequence(((n,t)=>{if("END"!=t)noiseSynth.triggerAttackRelease();else{let n=new Tone.Sequence(((e,n)=>{"END"!=n&&(synth.triggerAttackRelease(n,".1n",e),noiseSynth.triggerAttackRelease())}),e).start();n.loop=1}}),[1,2,3,4,"END"]).start().loop=1}function tocarSequencia(e){DBG("IN tocarSequencia"),e>=basicSounds.length&&(e=basicSounds.length-1);let n=[...Array(e).keys()].map((e=>++e));DBG("seqIndex=",n);let t=[];for(const e of n)DBG("n=",e),t.push(basicSounds[e]);DBG("sequencia=",t),new Tone.Sequence(((e,n)=>{synth.triggerAttackRelease(n,".1n",e)}),t).start().loop=0,DBG("OUT tocarSequencia")}window.onload=function(){document.getElementById("resposta-button").addEventListener("click",(()=>{sequenciaResposta&&0!=sequenciaResposta.length?document.getElementById("resposta-text").innerHTML=sequenciaResposta.toString().replaceAll(",",""):document.getElementById("resposta-text").innerHTML="Aperte o botão <b>Tocar sequência</b> antes"})),document.getElementById("reset-button").addEventListener("click",(()=>{sequenciaResposta=[],sounds=[],document.getElementById("resposta-text").innerHTML="Aperte o botão <b>Tocar sequência</b> antes",DBG("sequencia apagada!")})),document.getElementById("padrao-button").addEventListener("click",(async()=>{let e=1*document.getElementById("inputQntTons").value||7;if(null==e||"number"!=typeof e||e<=0)return DBG("Quantidade de tons inserida incorretamente"),void alert("Defina Quantos graus maiores");"started"==Tone.Transport.state&&(Tone.Transport.stop(),Tone.Transport.cancel());let n=1*document.getElementById("inputBPM").value;DBG("bpm==",n),n<=10&&(n=40),Tone.Transport.bpm.value=n,await Tone.start(),Tone.Transport.start(),tocarSequencia(e)})),document.getElementById("play-button").addEventListener("click",(async()=>{let e=1*document.getElementById("inputQntTons").value;if(null==e||"number"!=typeof e||e<=0)return alert("Quantidade de tons inserida incorretamente"),void DBG("Defina Quantos graus maiores");let n=1*document.getElementById("inputBPM").value;if(DBG("bpm==",n),n<=10&&(n=40),null==(qntSons=1*document.getElementById("inputQntSons").value)||"number"!=typeof qntSons||qntSons<=0)return alert("Quantidade de sons inserida incorretamente"),void DBG("Defina quantos sons");qntSons>100&&(qntSons=100);let t=document.getElementById("inputQntSonsAleatorios").checked,o=document.getElementById("inputIncluirSilencio").checked,a=document.getElementById("inputSaltos").checked,s=document.getElementById("inputIniciaEmUm").checked;if((!sequenciaResposta||0==sequenciaResposta.length)&&t){if(!(qntSons>5)){let e="Defina mais de 5 sons";return DBG(e),void alert(e)}DBG("qnt=",qntSons=rando(5,qntSons))}"started"==Tone.Transport.state&&(Tone.Transport.stop(),Tone.Transport.cancel()),Tone.Transport.bpm.value=n,geraSequencia(e,o,s,a),await Tone.start(),Tone.Transport.start(),cria(),DBG("audio is ready")}),!1)};